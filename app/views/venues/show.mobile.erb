<% provide(:title, @venue.title) %>
<% provide(:page, "show_venue") %>

  <div data-role="header" <%= render 'shared/style' %>>

  <script type="text/javascript">




          function initialize() {




            document.getElementById('map-canvas').style.display = "";


             // This is the minimum zoom level that we'll allow
             var minZoomLevel = 15;
             var latlng = new google.maps.LatLng(<%= @venue.lat %>, <%= @venue.lng %>);
             var map = new google.maps.Map(document.getElementById('map-canvas'), {
                zoom: minZoomLevel,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
             });

            var marker = new google.maps.Marker({
                position: latlng,
                map: map,
                title:"You are here!"
            });

            google.maps.event.trigger(map, 'resize');
          }


  </script>

    <h1>Lugar</h1>
      <%= render 'shared/header_buttons' %>

  </div>
   
  <div data-role="content">

    <% flash.each do |key, value| %>
            <div class="alert alert-<%= key %>"><%= value %></div>
    <% end %>

    <aside>
       <section>

          <h1> <%= @venue.title %> </h1>
         
        </section>
    </aside>
    <aside class="span4">
      <section>


        <div class="stats">

        <%= link_to 'Ver Ubicación', "#", "data-role"=>"button", "data-mini"=>"true", "data-inline"=>"true", "onClick"=>"initialize()" %>

       <div id="map-canvas" style="width=100%; height:300px; display:none;"></div>  
          <p>Votos últimas 3 horas </p>

          <strong class="votes"><%=" Votos Netos #{@total_votes.count}" %></strong>
          <strong> | </strong>
          <strong class="votes"><%=" Entretenidos #{@positive_votes.count}" %></strong>
          <strong> | </strong>
          <strong class="votes"><%="Aburridos #{@negative_votes.count}" %></strong>

        </div>


      </section>

    </aside>
          <% if signed_in? %>
            <% if current_user.admin? || current_user?(@venue.user)%>
              <%= link_to "Eliminar", @venue,  "data-role"=>"button", "data-mini"=>"true", "data-inline"=>"true", "data-icon"=>"delete", "data-iconpos"=>"right", method: :delete, 
                                            data: { confirm: "You sure?" } %>
                <%= link_to 'Editar', edit_venue_path(@venue), "data-role"=>"button", "data-mini"=>"true", "data-inline"=>"true", "data-icon"=>"gear", "data-iconpos"=>"right" %>
            <% end %>
          <% end %>
   

<section class="center">
      <% if signed_in? %>

      <p>Si estás dentro del lugar, califícalo</p>

      <%= link_to("Entretenido", vote_up_venue_path(@venue), :method => :post, "data-role"=>"button", "data-inline"=>"true", "data-theme"=>"b", "data-icon"=>"arrow-u", "style"=>"width:150px", "data-iconpos"=>"right") %>
      <%= link_to("Aburrido", vote_down_venue_path(@venue), :method => :post, "data-role"=>"button", "data-inline"=>"true", "data-theme"=>"b", "data-icon"=>"arrow-d", "style"=>"width:150px") %>

      <% end %>
</section>


    <%= render 'shared/post_form' if signed_in? %>

          <% if @venue.posts.any? %>
            <h3>Comentarios (<%= @venue.posts.count %>)</h3>
     <ul data-role="listview" class="posts" >
            <% @venue.posts.each do |post| %>            

              <li data-icon="false" style="height:64px">
              <%= avatar_for(post.user,64,64) %>
              <div style="margin-top: -6px;">
              <span class="user">
               <%= link_to(post.user.name, post.user) %>
              </span>

                <span class="content"><%= post.content %></span>
                <span class="timestamp">
                  Posted <%= time_ago_in_words(post.created_at) %> ago.
                </span>
                <% if signed_in? %>
                  <% if current_user?(post.user) %>
                 
                    <%= link_to "Eliminar", post, method: :delete, "data-ajax"=>"false", "class" =>"delete", data: { confirm: "¿Seguro?" }, title: post.content %>
                                                 
                  <% end %>
                <% end %>

                </div>

              </li>

            <% end %>

     </ul>
            <%= will_paginate @posts %>
          <% end %>
      

  </div>






